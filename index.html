<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archive Log Generator v7.2</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Noto Serif KR', serif; 
            display: flex; height: 100vh; background: #08080c;
            overflow: hidden;
        }

        .editor-panel { 
            width: 420px; background: #0e0e14; 
            border-right: 1px solid #1a1a24; 
            padding: 16px; padding-bottom: 90px; overflow-y: auto; 
            display: flex; flex-direction: column; gap: 10px; 
            color: #c0c0d0;
        }

        .preview-panel { 
            flex: 1; padding: 24px; overflow-y: auto; 
            display: flex; justify-content: center; 
            background: #050508; 
            align-items: flex-start;
        }
        #preview-container { width: 100%; max-width: 720px; }

        .action-bar { 
            position: fixed; bottom: 0; left: 0; width: 420px; 
            background: #0e0e14; 
            border-top: 1px solid #1a1a24; padding: 10px 16px; 
            display: flex; gap: 8px; z-index: 100; 
        }

        @media (max-width: 900px) {
            body { flex-direction: column; overflow: auto; height: auto; }
            .editor-panel { width: 100%; }
            .preview-panel { min-height: 700px; }
            .action-bar { width: 100%; position: sticky; }
        }

        .editor-panel h2 { 
            font-size: 14px; color: #9090c0; margin-bottom: 3px;
            display: flex; align-items: center; gap: 8px;
        }

        .section-box { 
            background: #121218; 
            border: 1px solid #1e1e28; 
            padding: 12px; border-radius: 10px; 
        }
        .section-title { 
            font-size: 9px; font-weight: 700; margin-bottom: 10px; 
            color: #6060a0; text-transform: uppercase; letter-spacing: 0.15em;
            display: flex; align-items: center; gap: 8px;
        }
        .form-group { margin-bottom: 8px; }
        .form-group label { 
            display: block; font-size: 9px; font-weight: 600; 
            color: #505070; margin-bottom: 3px; text-transform: uppercase; letter-spacing:0.05em;
        }
        input, textarea, select { 
            width: 100%; padding: 8px 10px; 
            border: 1px solid #1e1e28; border-radius: 6px; 
            font-size: 12px; font-family: inherit; 
            background: #0a0a10; color: #c0c0d0;
            transition: border-color 0.2s;
        }
        input:focus, textarea:focus, select:focus { outline: none; border-color: #5050a0; }
        textarea { resize: vertical; min-height: 55px; }
        
        .btn { 
            padding: 8px 14px; border-radius: 6px; cursor: pointer; 
            font-size: 11px; font-weight: 600; border: none; transition: all 0.2s;
        }
        .btn-primary { background: linear-gradient(135deg, #4848a0, #6060c0); color: white; flex: 1; }
        .btn-primary:hover { background: linear-gradient(135deg, #5858b0, #7070d0); }
        .btn-outline { border: 1px solid #303048; color: #8888a8; background: transparent; }
        .btn-outline:hover { background: #16161e; }
        
        .btn-shortcut { 
            background: #18181e; padding: 3px 8px; 
            border-radius: 4px; font-size: 10px; cursor: pointer; 
            border: 1px solid #252530; margin-right: 3px;
            color: #8888a8; transition: all 0.15s;
        }
        .btn-shortcut:hover { background: #252530; }
        
        .log-entry { 
            border: 1px solid #1e1e28; 
            padding: 8px; border-radius: 6px; margin-bottom: 6px; 
            background: #0e0e14; 
        }
        
        .theme-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-bottom: 8px; }
        .theme-opt { 
            height: 48px; border-radius: 8px; cursor: pointer; 
            border: 2px solid transparent; font-size: 7px; 
            display: flex; flex-direction: column; align-items: center; 
            justify-content: center; font-weight: 700; transition: all 0.15s;
            gap: 2px; letter-spacing: 0.05em;
        }
        .theme-opt:hover { transform: scale(1.03); }
        .theme-opt.active { border-color: #6060c0; box-shadow: 0 0 16px rgba(96,96,192,0.3); }
        
        .toggle-row { 
            display: flex; align-items: center; gap: 8px; 
            padding: 6px 0;
        }
        .toggle-row input { width: auto; accent-color: #6060c0; }
        .toggle-row label { margin: 0; font-size: 10px; color: #7070a0; cursor: pointer; }

        .chapter-box { background: #14141a; border-color: #24243a; }
        
        .char-card {
            background: #0a0a10;
            border: 1px solid #1e1e28;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
        }
        .char-card-header {
            display: flex; align-items: center; gap: 8px; margin-bottom: 8px;
        }

        /* Ïª§Ïä§ÌÖÄ ÌÖåÎßà Ìé∏Ïßë ÏòÅÏó≠ */
        .custom-theme-editor {
            margin-top: 8px;
            padding: 10px;
            background: #0a0a10;
            border: 1px solid #1e1e28;
            border-radius: 8px;
        }
        .color-row {
            display: flex; align-items: center; gap: 6px; margin-bottom: 5px;
        }
        .color-row label {
            font-size: 9px; color: #505070; width: 80px; flex-shrink: 0;
            margin: 0;
        }
        .color-row input[type="color"] {
            width: 28px; height: 22px; padding: 1px; border-radius: 4px; flex-shrink: 0;
        }
        .color-row input[type="text"] {
            flex: 1; padding: 4px 6px; font-size: 10px;
        }
    </style>
</head>
<body>

<div class="editor-panel">
    <h2>‚óà Archive Log <span style="font-size:9px; color:#404060; font-weight:400;">v0.1</span></h2>

    <div class="section-box">
        <div class="section-title">ÌÖåÎßà</div>
        <div class="theme-grid" id="themeGrid">
            <div class="theme-opt active" onclick="setTheme('obsidian', this)" style="background:linear-gradient(135deg,#0a0a0f,#14141c); color:#d0d0e8;">OBSIDIAN</div>
            <div class="theme-opt" onclick="setTheme('vintage', this)" style="background:linear-gradient(135deg,#f4efe4,#e8e0d0); color:#3a352a;">VINTAGE</div>
            <div class="theme-opt" onclick="setTheme('sakura', this)" style="background:linear-gradient(135deg,#fff8fa,#ffe8f0); color:#8a4a60;">SAKURA</div>
            <div class="theme-opt" onclick="setTheme('pure', this)" style="background:linear-gradient(135deg,#ffffff,#f5f5f5); color:#1a1a1a; border:1px solid #ddd;">PURE</div>
            <div class="theme-opt" onclick="setTheme('violet', this)" style="background:linear-gradient(135deg,#1a1420,#241830); color:#d8c0e8;">VIOLET</div>
        </div>

        <div class="toggle-row">
            <input type="checkbox" id="useCustomTheme" onchange="toggleCustomTheme()">
            <label for="useCustomTheme">Ïª§Ïä§ÌÖÄ ÌÖåÎßà ÏÇ¨Ïö©</label>
        </div>

        <div class="custom-theme-editor" id="customThemeEditor" style="display:none;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                <span style="font-size:9px; font-weight:600; color:#6060a0; letter-spacing:0.1em;">CUSTOM COLORS</span>
                <div>
                    <button class="btn-shortcut" onclick="loadPresetIntoCustom()">ÌîÑÎ¶¨ÏÖã Î∂àÎü¨Ïò§Í∏∞</button>
                    <button class="btn-shortcut" onclick="saveCustomTheme()">üíæ Ï†ÄÏû•</button>
                </div>
            </div>
            <div class="color-row"><label>Î∞∞Í≤Ω (wrap)</label><input type="color" id="ct_wrapBg" value="#08080c" oninput="syncColorText(this)"><input type="text" data-for="ct_wrapBg" value="#08080c" oninput="syncColorPicker(this)"></div>
            <div class="color-row"><label>Ïπ¥Îìú Î∞∞Í≤Ω</label><input type="color" id="ct_cardBg" value="#0c0c12" oninput="syncColorText(this)"><input type="text" data-for="ct_cardBg" value="#0c0c12" oninput="syncColorPicker(this)"></div>
            <div class="color-row"><label>Î≥∏Î¨∏ Î∞∞Í≤Ω</label><input type="color" id="ct_contentBg" value="#0a0a0e" oninput="syncColorText(this)"><input type="text" data-for="ct_contentBg" value="#0a0a0e" oninput="syncColorPicker(this)"></div>
            <div class="color-row"><label>Ìó§Îçî Î∞∞Í≤Ω</label><input type="color" id="ct_headerBg" value="#0e0e14" oninput="syncColorText(this)"><input type="text" data-for="ct_headerBg" value="#0e0e14" oninput="syncColorPicker(this)"></div>
            <div class="color-row"><label>Î≥∏Î¨∏ ÌÖçÏä§Ìä∏</label><input type="color" id="ct_text" value="#d8d8e8" oninput="syncColorText(this)"><input type="text" data-for="ct_text" value="#d8d8e8" oninput="syncColorPicker(this)"></div>
            <div class="color-row"><label>Î≥¥Ï°∞ ÌÖçÏä§Ìä∏</label><input type="color" id="ct_textSoft" value="#a0a0b8" oninput="syncColorText(this)"><input type="text" data-for="ct_textSoft" value="#a0a0b8" oninput="syncColorPicker(this)"></div>
            <div class="color-row"><label>ÌùêÎ¶∞ ÌÖçÏä§Ìä∏</label><input type="color" id="ct_textMuted" value="#606078" oninput="syncColorText(this)"><input type="text" data-for="ct_textMuted" value="#606078" oninput="syncColorPicker(this)"></div>
            <div class="color-row"><label>Í∞ïÏ°∞ÏÉâ</label><input type="color" id="ct_accent" value="#8080c0" oninput="syncColorText(this)"><input type="text" data-for="ct_accent" value="#8080c0" oninput="syncColorPicker(this)"></div>
            <div class="color-row"><label>ÌÖåÎëêÎ¶¨</label><input type="color" id="ct_border" value="#1a1a28" oninput="syncColorText(this)"><input type="text" data-for="ct_border" value="#1a1a28" oninput="syncColorPicker(this)"></div>
            <div class="color-row"><label>Íµ¨Î∂ÑÏÑ†</label><input type="color" id="ct_divider" value="#18182a" oninput="syncColorText(this)"><input type="text" data-for="ct_divider" value="#18182a" oninput="syncColorPicker(this)"></div>
        </div>
    </div>

    <div class="section-box">
        <div class="section-title">ÌëúÏßÄ</div>
        <div class="form-group"><label>Ï†úÎ™©</label><input type="text" id="coverTitle" value="Story Title" oninput="renderPreview()"></div>
        <div class="form-group"><label>Î∂ÄÏ†ú</label><input type="text" id="coverSubtitle" value="A √ó B" oninput="renderPreview()"></div>
        <div class="form-group"><label>Ïù¥ÎØ∏ÏßÄ URL</label><input type="text" id="coverImg" value="https:" oninput="renderPreview()"></div>
        <div style="display:flex; gap:6px;">
            <div class="form-group" style="flex:1;"><label>ÎÇ†Ïßú</label><input type="text" id="dateText" value="ÎÇ†Ïßú" oninput="renderPreview()"></div>
            <div class="form-group" style="flex:1;"><label>Î∂ÑÎ•ò</label><input type="text" id="tagText" value="FICTION" oninput="renderPreview()"></div>
        </div>
    </div>
    <div class="section-box">
        <div class="section-title"><span>Ï∫êÎ¶≠ÌÑ∞</span></div>
        <div class="toggle-row">
            <input type="checkbox" id="showCharIntro" checked onchange="renderPreview()">
            <label for="showCharIntro">Ï∫êÎ¶≠ÌÑ∞ ÏÜåÍ∞ú ÏÑπÏÖò ÌëúÏãú</label>
        </div>
        
        <div class="char-card">
            <div class="char-card-header">
                <span style="font-size:10px; font-weight:700; color:#e8a0b0;">A</span>
                <input type="text" id="charAName" value="Name A" oninput="renderPreview()" style="flex:1;">
                <input type="color" id="charAColor" value="#E8A0B0" oninput="renderPreview()" style="width:32px; height:26px; padding:1px;">
            </div>
            <div class="form-group" style="margin:0 0 6px 0;"><label>Ïù¥ÎØ∏ÏßÄ URL</label><input type="text" id="charAImg" oninput="renderPreview()" value="https:"></div>
            <div class="form-group" style="margin:0 0 6px 0;"><label>ÏÜåÍ∞ú</label><textarea id="charADesc" oninput="renderPreview()" style="min-height:36px;">Ï∫êÎ¶≠ÌÑ∞ ÏÜåÍ∞ú</textarea></div>
            <div class="form-group" style="margin:0;"><label>‚Üí BÏóêÍ≤å</label><input type="text" id="charAThought" value="ÏÉÅÎåÄÎ•º Ìñ•Ìïú Ìïú ÎßàÎîî" oninput="renderPreview()"></div>
        </div>
        
        <div class="char-card">
            <div class="char-card-header">
                <span style="font-size:10px; font-weight:700; color:#90c0e0;">B</span>
                <input type="text" id="charBName" value="Name B" oninput="renderPreview()" style="flex:1;">
                <input type="color" id="charBColor" value="#90C0E0" oninput="renderPreview()" style="width:32px; height:26px; padding:1px;">
            </div>
            <div class="form-group" style="margin:0 0 6px 0;"><label>Ïù¥ÎØ∏ÏßÄ URL</label><input type="text" id="charBImg" oninput="renderPreview()" value="https:"></div>
            <div class="form-group" style="margin:0 0 6px 0;"><label>ÏÜåÍ∞ú</label><textarea id="charBDesc" oninput="renderPreview()" style="min-height:36px;">Ï∫êÎ¶≠ÌÑ∞ ÏÜåÍ∞ú</textarea></div>
            <div class="form-group" style="margin:0;"><label>‚Üí AÏóêÍ≤å</label><input type="text" id="charBThought" value="ÏÉÅÎåÄÎ•º Ìñ•Ìïú Ìïú ÎßàÎîî" oninput="renderPreview()"></div>              
        </div>
    </div>
    <div class="section-box">
        <div class="section-title">Ìï¥ÏãúÌÉúÍ∑∏</div>
        <input type="text" id="hashTags" value="ÌÉúÍ∑∏1,ÌÉúÍ∑∏2,ÌÉúÍ∑∏3" oninput="renderPreview()" placeholder="ÌÉúÍ∑∏Î•º ÏâºÌëú(,)Î°ú Íµ¨Î∂Ñ">
    </div>
    <div id="chapters-container"></div>
    
    <div class="section-box" style="padding:8px 12px;">
        <div class="toggle-row">
            <input type="checkbox" id="useCollapse" checked onchange="renderPreview()">
            <label for="useCollapse">Ï±ïÌÑ∞ Ï†ëÍ∏∞/ÌéºÏπòÍ∏∞</label>
        </div>
    </div>
    
    <button class="btn btn-outline" onclick="addChapter()" style="width:100%;">+ Ï±ïÌÑ∞ Ï∂îÍ∞Ä</button>

 <!-- Î≥ÄÍ≤Ω ÌõÑ -->
<div class="section-box">
    <div class="section-title">ÌïòÎã®</div>
    <div class="form-group"><label>ÏûëÏÑ±Ïûê</label><input type="text" id="authorName" value="Ïù¥Î¶Ñ" oninput="renderPreview()"></div>
    <div class="toggle-row">
        <input type="checkbox" id="showNote" checked onchange="renderPreview()">
        <label for="showNote">ÏΩîÎ©òÌä∏ ÌëúÏãú</label>
    </div>
    <div class="form-group"><label>ÏΩîÎ©òÌä∏</label><textarea id="commentText" oninput="renderPreview()">ÏΩîÎ©òÌä∏</textarea></div>
</div>
</div>

<div class="action-bar">
    <button class="btn btn-outline" onclick="renderPreview()">ÏÉàÎ°úÍ≥†Ïπ®</button>
    <button class="btn btn-primary" onclick="copyCode()">HTML Î≥µÏÇ¨</button>
</div>

<div class="preview-panel">
    <div id="preview-container"></div>
</div>

<div id="bigEditorModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:9999;">
    <div style="width:90%; max-width:800px; height:80%; margin:5% auto; background:#121218; border:1px solid #2a2a3a; border-radius:12px; display:flex; flex-direction:column;">
<div style="padding:16px 20px; border-bottom:1px solid #2a2a3a; display:flex; justify-content:space-between; align-items:center;">
    <div style="display:flex; align-items:center; gap:12px;">
        <span style="color:#9090c0; font-size:13px; font-weight:600;">Î≥∏Î¨∏ Ìé∏Ïßë</span>
        <div>
            <span class="btn-shortcut" onclick="insertTagBig('„Ñ±: ')">char</span>
            <span class="btn-shortcut" onclick="insertTagBig('„Ñ¥: ')">user</span>
            <span class="btn-shortcut" onclick="insertTagBig('„ÖÖ: ')">ÏÜçÎßàÏùå</span>
            <span class="btn-shortcut" onclick="insertTagBig('„Ñ∑: ')">ÎèÖÎ∞±</span>
        </div>
    </div>
    <button onclick="closeBigEditor()" style="background:none; border:none; color:#606080; font-size:24px; cursor:pointer;">&times;</button>
</div>

        <textarea id="bigEditorTextarea" style="flex:1; margin:16px; padding:20px; background:#0a0a10; border:1px solid #1e1e28; border-radius:8px; color:#c0c0d0; font-size:14px; line-height:1.8; resize:none;"></textarea>
        <div style="padding:16px 20px; border-top:1px solid #2a2a3a; text-align:right;">
            <button onclick="closeBigEditor()" class="btn btn-outline" style="margin-right:8px;">Ï∑®ÏÜå</button>
            <button onclick="saveBigEditor()" class="btn btn-primary">Ï†ÅÏö©</button>
        </div>
    </div>
</div>

<script>
    let chapterCount = 0;
    
    const themes = {
        obsidian: {
            wrapBg: '#08080c', cardBg: '#0c0c12', contentBg: '#0a0a0e', headerBg: '#0e0e14',
            text: '#d8d8e8', textSoft: '#a0a0b8', textMuted: '#606078',
            accent: '#8080c0', accentGlow: 'rgba(128,128,192,0.15)',
            border: '#1a1a28', divider: '#18182a',
            coverTextShadow: '0 2px 16px rgba(0,0,0,0.9)',
            stripeBg: 'repeating-linear-gradient(135deg, transparent, transparent 1px, rgba(128,128,192,0.03) 1px, rgba(128,128,192,0.03) 2px)',
        },
        vintage: {
            wrapBg: '#f0ebe0', cardBg: '#f8f5ee', contentBg: '#fffdf8', headerBg: '#f4efe4',
            text: '#2a2620', textSoft: '#5a5448', textMuted: '#8a8478',
            accent: '#8a7a60', accentGlow: 'rgba(138,122,96,0.1)',
            border: '#e0d8c8', divider: '#e8e0d0',
            coverTextShadow: '0 2px 12px rgba(0,0,0,0.2)',
            stripeBg: 'repeating-linear-gradient(135deg, transparent, transparent 1px, rgba(138,122,96,0.04) 1px, rgba(138,122,96,0.04) 2px)',
        },
        sakura: {
            wrapBg: '#fff5f8', cardBg: '#fffafc', contentBg: '#ffffff', headerBg: '#fff8fa',
            text: '#3a2830', textSoft: '#6a4858', textMuted: '#a08090',
            accent: '#d88aa0', accentGlow: 'rgba(216,138,160,0.12)',
            border: '#f8d8e0', divider: '#ffe8f0',
            coverTextShadow: '0 2px 12px rgba(0,0,0,0.15)',
            stripeBg: 'repeating-linear-gradient(135deg, transparent, transparent 1px, rgba(216,138,160,0.05) 1px, rgba(216,138,160,0.05) 2px)',
        },
        pure: {
            wrapBg: '#f8f8f8', cardBg: '#ffffff', contentBg: '#fafafa', headerBg: '#f5f5f5',
            text: '#1a1a1a', textSoft: '#4a4a4a', textMuted: '#888888',
            accent: '#3a3a3a', accentGlow: 'rgba(0,0,0,0.04)',
            border: '#e0e0e0', divider: '#eeeeee',
            coverTextShadow: '0 2px 12px rgba(0,0,0,0.12)',
            stripeBg: 'repeating-linear-gradient(135deg, transparent, transparent 1px, rgba(0,0,0,0.02) 1px, rgba(0,0,0,0.02) 2px)',
        },
        violet: {
            wrapBg: '#12101a', cardBg: '#18141f', contentBg: '#140f1a', headerBg: '#1a1520',
            text: '#e0d8f0', textSoft: '#b8a8d0', textMuted: '#706088',
            accent: '#a880d0', accentGlow: 'rgba(168,128,208,0.12)',
            border: '#2a2038', divider: '#241a30',
            coverTextShadow: '0 2px 16px rgba(0,0,0,0.9)',
            stripeBg: 'repeating-linear-gradient(135deg, transparent, transparent 1px, rgba(168,128,208,0.03) 1px, rgba(168,128,208,0.03) 2px)',
        }
    };
    
    let currentTheme = 'obsidian';

    // ‚îÄ‚îÄ Ïª§Ïä§ÌÖÄ ÌÖåÎßà Í¥ÄÎ†® ‚îÄ‚îÄ

    const customColorKeys = ['wrapBg','cardBg','contentBg','headerBg','text','textSoft','textMuted','accent','border','divider'];

    function getCustomTheme() {
        const ct = {};
        customColorKeys.forEach(key => {
            ct[key] = document.getElementById('ct_' + key).value;
        });
        // accentGlow ÏûêÎèô ÏÉùÏÑ± (accent ÏÉâÏÉÅ Í∏∞Î∞ò)
        const a = ct.accent;
        const r = parseInt(a.slice(1,3),16), g = parseInt(a.slice(3,5),16), b = parseInt(a.slice(5,7),16);
        ct.accentGlow = `rgba(${r},${g},${b},0.12)`;
        ct.coverTextShadow = isLightColor(ct.wrapBg) ? '0 2px 12px rgba(0,0,0,0.15)' : '0 2px 16px rgba(0,0,0,0.9)';
        ct.stripeBg = `repeating-linear-gradient(135deg, transparent, transparent 1px, rgba(${r},${g},${b},0.03) 1px, rgba(${r},${g},${b},0.03) 2px)`;
        return ct;
    }

    function isLightColor(hex) {
        const r = parseInt(hex.slice(1,3),16), g = parseInt(hex.slice(3,5),16), b = parseInt(hex.slice(5,7),16);
        return (r*299 + g*587 + b*114) / 1000 > 128;
    }

    function syncColorText(picker) {
        const textInput = picker.parentElement.querySelector('input[type="text"]');
        textInput.value = picker.value;
        renderPreview();
    }

    function syncColorPicker(textInput) {
        const key = textInput.dataset.for;
        const picker = document.getElementById(key);
        if (/^#[0-9a-fA-F]{6}$/.test(textInput.value)) {
            picker.value = textInput.value;
        }
        renderPreview();
    }

    function toggleCustomTheme() {
        const checked = document.getElementById('useCustomTheme').checked;
        document.getElementById('customThemeEditor').style.display = checked ? 'block' : 'none';
        if (checked) {
            // ÌîÑÎ¶¨ÏÖã ÏÑ†ÌÉù Ìï¥Ï†ú ÎπÑÏ£ºÏñº
            document.querySelectorAll('.theme-opt').forEach(opt => opt.style.opacity = '0.4');
        } else {
            document.querySelectorAll('.theme-opt').forEach(opt => opt.style.opacity = '1');
        }
        renderPreview();
    }

    function loadPresetIntoCustom() {
        const preset = themes[currentTheme];
        customColorKeys.forEach(key => {
            const picker = document.getElementById('ct_' + key);
            const textInput = picker.parentElement.querySelector('input[type="text"]');
            picker.value = preset[key];
            textInput.value = preset[key];
        });
        renderPreview();
    }

    function saveCustomTheme() {
        const data = {};
        customColorKeys.forEach(key => {
            data[key] = document.getElementById('ct_' + key).value;
        });
        try {
            localStorage.setItem('archiveLog_customTheme', JSON.stringify(data));
            alert('‚úÖ Ïª§Ïä§ÌÖÄ ÌÖåÎßàÍ∞Ä Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
        } catch(e) {
            alert('‚ö†Ô∏è Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
        }
    }

    function loadSavedCustomTheme() {
        try {
            const saved = localStorage.getItem('archiveLog_customTheme');
            if (saved) {
                const data = JSON.parse(saved);
                customColorKeys.forEach(key => {
                    if (data[key]) {
                        const picker = document.getElementById('ct_' + key);
                        const textInput = picker.parentElement.querySelector('input[type="text"]');
                        picker.value = data[key];
                        textInput.value = data[key];
                    }
                });
            }
        } catch(e) {}
    }

    function getActiveTheme() {
        if (document.getElementById('useCustomTheme').checked) {
            return getCustomTheme();
        }
        return themes[currentTheme];
    }

    function setTheme(themeName, el) {
        currentTheme = themeName;
        document.querySelectorAll('.theme-opt').forEach(opt => opt.classList.remove('active'));
        el.classList.add('active');
        // Ïª§Ïä§ÌÖÄ ÌÖåÎßà Ìï¥Ï†ú
        document.getElementById('useCustomTheme').checked = false;
        document.getElementById('customThemeEditor').style.display = 'none';
        document.querySelectorAll('.theme-opt').forEach(opt => opt.style.opacity = '1');
        renderPreview();
    }

    // ‚îÄ‚îÄ Ï±ïÌÑ∞/Î°úÍ∑∏ ‚îÄ‚îÄ

    function addChapter() {
        chapterCount++;
        const id = `chap-${chapterCount}`;
        const html = `
            <div class="section-box chapter-box" id="${id}" style="margin-bottom:8px;">
                <div class="section-title" style="display:flex; justify-content:space-between; align-items:center;">
                    <span>Chapter ${chapterCount}</span>
                    <button class="btn" style="color:#c07070; padding:1px 6px; font-size:9px; background:transparent; border:1px solid #c07070;" onclick="document.getElementById('${id}').remove(); renderPreview();">ÏÇ≠Ï†ú</button>
                </div>
                <div class="form-group"><label>Ï†úÎ™©</label><input type="text" class="chap-title" value="Chapter Title" oninput="renderPreview()"></div>
                <div class="form-group"><label>Ï†ïÎ≥¥</label><input type="text" class="chap-info" value="Scene 01" oninput="renderPreview()"></div>
                <div id="logs-${id}"></div>
                <button class="btn btn-outline" style="width:100%; margin-top:6px; font-size:9px; padding:6px;" onclick="addLog('${id}')">+ ÎåÄÏÇ¨</button>
            </div>`;
        document.getElementById('chapters-container').insertAdjacentHTML('beforeend', html);
        addLog(id);
    }

    function addLog(chapId) {
        const logId = `log-${Date.now()}`;
        const html = `
            <div class="log-entry" id="${logId}">
                <div style="margin-bottom:4px; display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <span class="btn-shortcut" onclick="insertTag('${logId}', '„Ñ±: ')">char</span>
                        <span class="btn-shortcut" onclick="insertTag('${logId}', '„Ñ¥: ')">user</span>
                        <span class="btn-shortcut" onclick="insertTag('${logId}', '„ÖÖ: ')">ÏÜçÎßàÏùå</span>
                        <span class="btn-shortcut" onclick="insertTag('${logId}', '„Ñ∑: ')">ÎèÖÎ∞±</span>
                    </div>
                    <button style="border:none; background:none; cursor:pointer; color:#7070a0; font-size:11px; margin-right:8px;" onclick="openBigEditor('${logId}')">ÌôïÎåÄ</button>
                    <button style="border:none; background:none; cursor:pointer; color:#505068; font-size:14px;" onclick="document.getElementById('${logId}').remove(); renderPreview();">√ó</button>
                </div>
                <textarea class="log-content" oninput="renderPreview()" placeholder="„Ñ±: charÎåÄÏÇ¨ / „Ñ¥: userÎåÄÏÇ¨ / „ÖÖ: ÏÜçÎßàÏùå / „Ñ∑: ÎèÖÎ∞±"></textarea>
            </div>`;
        document.getElementById(`logs-${chapId}`).insertAdjacentHTML('beforeend', html);
    }

    function insertTag(id, tag) {
        const el = document.getElementById(id).querySelector('textarea');
        const start = el.selectionStart;
        const newLine = start > 0 && el.value[start-1] !== '\n' ? '\n' : '';
        el.value = el.value.substring(0, start) + newLine + tag + el.value.substring(el.selectionEnd);
        el.selectionStart = el.selectionEnd = start + newLine.length + tag.length;
        el.focus();
        renderPreview();
    }

    function extractQuoted(text) {
        const match = text.match(/[\u201C\u201D]([^\u201C\u201D]+)[\u201C\u201D]/) || text.match(/"([^"]+)"/);
        if (match) return match[1];
        return text;
    }
function parseMarkdown(text, theme) {
    // Î≥ºÎìú (**text**) ‚Üí ÌòïÍ¥ëÌéú Í∞ïÏ°∞
    text = text.replace(/\*\*(.+?)\*\*/g, 
        `<span style="font-weight:700; background:${theme.accent}30; padding:1px 5px; border-radius:3px;">$1</span>`
    );
    // Ïù¥ÌÉ§Î¶≠ (*text*)
    text = text.replace(/\*(.+?)\*/g, 
        '<em style="font-style:italic;">$1</em>'
    );
    // Ìó§Îî© (Ï§Ñ Îã®ÏúÑÎ°ú Ï≤òÎ¶¨)
    text = text.replace(/^### (.+)$/gm, 
        `<div style="font-size:16px; font-weight:bold; margin:20px 0 10px; color:${theme.text};">$1</div>`
    );
    text = text.replace(/^## (.+)$/gm, 
        `<div style="font-size:20px; font-weight:700; margin:24px 0 12px; color:${theme.text};">$1</div>`
    );
    text = text.replace(/^# (.+)$/gm, 
        `<div style="font-size:26px; font-weight:700; margin:28px 0 14px; color:${theme.text};">$1</div>`
    );
    return text;
}

    // ‚îÄ‚îÄ HTML ÏÉùÏÑ± ‚îÄ‚îÄ

    function generateFullHTML() {
        const t = getActiveTheme();
        const coverTitle = document.getElementById('coverTitle').value;
        const coverSubtitle = document.getElementById('coverSubtitle').value;
        const coverImg = document.getElementById('coverImg').value;
        const dateText = document.getElementById('dateText').value;
        const tagText = document.getElementById('tagText').value;
        const charAName = document.getElementById('charAName').value;
        const charAColor = document.getElementById('charAColor').value;
        const charBName = document.getElementById('charBName').value;
        const charBColor = document.getElementById('charBColor').value;
        const charADesc = document.getElementById('charADesc').value;
        const charBDesc = document.getElementById('charBDesc').value;
        const charAThought = document.getElementById('charAThought').value;
        const charBThought = document.getElementById('charBThought').value;
        const showCharIntro = document.getElementById('showCharIntro').checked;
        const useCollapse = document.getElementById('useCollapse').checked;
        const commentText = document.getElementById('commentText').value;
        const charAImg = document.getElementById('charAImg').value;
        const charBImg = document.getElementById('charBImg').value;
        const hashTags = document.getElementById('hashTags').value;
        const authorName = document.getElementById('authorName').value;

        // Ï∫êÎ¶≠ÌÑ∞ ÏÜåÍ∞ú
        let charIntroHTML = '';
        if (showCharIntro) {
            const charAImgStyle = charAImg ? `background:url('${charAImg}') center/cover no-repeat;` : `background:${charAColor}30;`;
            const charBImgStyle = charBImg ? `background:url('${charBImg}') center/cover no-repeat;` : `background:${charBColor}30;`;
            
            charIntroHTML = `
            <div style="padding:36px 24px; background:${t.contentBg}; border-top:1px solid ${t.divider};">
                <div style="text-align:center; margin-bottom:32px;">
                    <span style="font-size:9px; font-weight:600; letter-spacing:0.3em; color:${t.textMuted}; text-transform:uppercase;">Relationship</span>
                </div>
                <div style="display:table; width:100%;">
                    <div style="display:table-row;">
                        <div style="display:table-cell; width:38%; vertical-align:top; text-align:center; padding:20px 12px 16px; background:${t.accentGlow}; border-radius:12px;">
                            <div style="width:84px; height:84px; ${charAImgStyle} border-radius:50%; margin:0 auto 14px; border:2px solid ${charAColor}; box-shadow:0 0 0 4px ${charAColor}20;"></div>
                            <div style="font-size:15px; font-weight:600; color:${charAColor}; margin-bottom:4px;">${charAName}</div>
                            <div style="width:24px; height:1px; background:${charAColor}; margin:0 auto 10px;"></div>
                            <div style="font-size:11px; line-height:1.7; color:${t.textSoft};">${charADesc.replace(/\n/g, '<br>')}</div>
                        </div>
                        <div style="display:table-cell; width:24%; vertical-align:middle; text-align:center; padding:0 4px;">
                            <div style="padding:12px 0;">
                                <div style="font-size:14px; font-weight:700; color:${charAColor}; margin-bottom:4px;">‚ü∂</div>
                                <div style="font-size:10px; color:${t.textMuted}; font-style:italic; line-height:1.6; padding:8px 4px; border-top:2px solid ${charAColor}50; border-bottom:1px dashed ${t.divider};">\u300C${charAThought}\u300D</div>
                                <div style="margin:10px 0; font-size:11px; color:${t.accent};">\u2726</div>
                                <div style="font-size:10px; color:${t.textMuted}; font-style:italic; line-height:1.6; padding:8px 4px; border-top:1px dashed ${t.divider}; border-bottom:2px solid ${charBColor}50;">\u300C${charBThought}\u300D</div>
                                <div style="font-size:14px; font-weight:700; color:${charBColor}; margin-top:4px;">‚üµ</div>
                            </div>
                        </div>
                        <div style="display:table-cell; width:38%; vertical-align:top; text-align:center; padding:20px 12px 16px; background:${t.accentGlow}; border-radius:12px;">
                            <div style="width:84px; height:84px; ${charBImgStyle} border-radius:50%; margin:0 auto 14px; border:2px solid ${charBColor}; box-shadow:0 0 0 4px ${charBColor}20;"></div>
                            <div style="font-size:15px; font-weight:600; color:${charBColor}; margin-bottom:4px;">${charBName}</div>
                            <div style="width:24px; height:1px; background:${charBColor}; margin:0 auto 10px;"></div>
                            <div style="font-size:11px; line-height:1.7; color:${t.textSoft};">${charBDesc.replace(/\n/g, '<br>')}</div>
                        </div>
                    </div>
                </div>
            </div>`;
        }

        // Ï±ïÌÑ∞
        let chaptersHTML = '';
        document.querySelectorAll('.chapter-box').forEach((chap, idx) => {
            const title = chap.querySelector('.chap-title').value;
            const info = chap.querySelector('.chap-info').value;
            let logsHTML = '';
            
            chap.querySelectorAll('.log-content').forEach(logEl => {
    logEl.value.split('\n').forEach(line => {
        if(!line.trim()) return;
        let content = line.trim();
        
        // ‚îÄ‚îÄ Ìó§Îî© Ï†ÑÏö© Ï§Ñ (# ## ###) ‚îÄ‚îÄ
        if (/^#{1,3} /.test(content)) {
            logsHTML += `<div style="padding:0 8px;">${parseMarkdown(content, t)}</div>`;
            return;
        }
        
        if(content.startsWith('„Ñ±:')) {
            let txt = content.replace('„Ñ±:', '').trim();
            txt = extractQuoted(txt);
            logsHTML += `
            <div style="margin-bottom:24px;">
                <div style="margin-bottom:8px;">
                    <span style="font-size:6px; color:${charAColor}; margin-right:6px; vertical-align:middle;">‚óè</span>
                    <span style="font-size:11px; font-weight:600; color:${charAColor}; vertical-align:middle;">${charAName}</span>
                </div>
                <div style="display:inline-block; max-width:82%; padding:16px 22px; background-color:${charAColor}18; border-left:3px solid ${charAColor}; border-radius:0 12px 12px 0; font-size:14.5px; line-height:1.9; color:${t.text};">${parseMarkdown(txt, t)}</div>
            </div>`;
        } else if(content.startsWith('„Ñ¥:')) {
            let txt = content.replace('„Ñ¥:', '').trim();
            txt = extractQuoted(txt);
            logsHTML += `
            <div style="margin-bottom:24px; text-align:right;">
                <div style="margin-bottom:8px;">
                    <span style="font-size:11px; font-weight:600; color:${charBColor}; vertical-align:middle;">${charBName}</span>
                    <span style="font-size:6px; color:${charBColor}; margin-left:6px; vertical-align:middle;">‚óè</span>
                </div>
                <div style="display:inline-block; max-width:82%; padding:16px 22px; background-color:${charBColor}18; border-right:3px solid ${charBColor}; border-radius:12px 0 0 12px; font-size:14.5px; line-height:1.9; color:${t.text};">${parseMarkdown(txt, t)}</div>
            </div>`;                    
        } else if(content.startsWith('„ÖÖ:')) {
            let txt = content.replace('„ÖÖ:', '').trim();
            logsHTML += `
            <div style="margin:40px 16px; padding:20px 24px; text-align:center; border-top:1px solid ${t.divider}; border-bottom:1px solid ${t.divider};">
                <span style="font-size:14px; line-height:2.2; color:${t.textMuted}; letter-spacing:0.04em;">${parseMarkdown(txt, t)}</span>
            </div>`;
        } else if(content.startsWith('„Ñ∑:')) {
            let txt = content.replace('„Ñ∑:', '').trim();
            logsHTML += `
            <div style="margin:24px 20px; text-align:center;">
                <span style="display:inline-block; padding:10px 24px; background:${t.accentGlow}; border:1px dashed ${t.divider}; border-radius:4px; font-size:14px; color:${t.textMuted}; font-style:italic; letter-spacing:0.04em;">${parseMarkdown(txt, t)}</span>
            </div>`;
        } else {
            logsHTML += `
            <div style="margin-bottom:22px; padding:0 8px; font-size:14px; line-height:2; color:${t.text}; text-indent:1em;">${parseMarkdown(content, t)}</div>`;
        }
    });
});


            const contentBlock = `
                <div style="padding:30px 24px; background:${t.contentBg}; ${t.stripeBg};">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:28px; padding-bottom:16px; border-bottom:1px dashed ${t.divider};">
                        <span style="font-size:10px; color:${t.textMuted}; letter-spacing:0.15em; text-transform:uppercase;">${info}</span>                       
                    </div>
                    ${logsHTML}
                </div>`;

            // Ï±ïÌÑ∞ Ìó§Îçî (ÎÜíÏù¥ Ï∂ïÏÜå)
            const chapterHeader = `
                <div style="padding:20px 24px 16px; background-color:${t.headerBg}; border-bottom:1px solid ${t.divider}; text-align:center;">
                    <div style="font-size:32px; font-weight:100; color:${t.textMuted}; opacity:0.3; font-family:Georgia,serif; margin-bottom:4px;">${String(idx+1).padStart(2,'0')}</div>
                    <div style="font-size:15px; font-weight:500; color:${t.text}; letter-spacing:0.06em;">${title}</div>
                    <div style="width:30px; height:1px; background:${t.accent}; margin:10px auto 0;"></div>
                </div>`;

            if(useCollapse) {
                chaptersHTML += `
                <details style="border-top:1px solid ${t.divider};" ${idx === 0 ? 'open' : ''}>
                    <summary style="list-style:none; display:block; padding:12px 24px 16px; background-color:${t.headerBg}; cursor:pointer; text-align:center;">
                        <div style="font-size:32px; font-weight:100; color:${t.textMuted}; opacity:0.3; font-family:Georgia,serif; margin-bottom:4px;">${String(idx+1).padStart(2,'0')}</div>
                        <div style="font-size:15px; font-weight:500; color:${t.text}; letter-spacing:0.06em;">${title}</div>
                        <div style="width:30px; height:1px; background:${t.accent}; margin:10px auto 0;"></div>
                    </summary>
                    ${contentBlock}
                </details>`;
            } else {
                chaptersHTML += `
                <div style="border-top:1px solid ${t.divider};">
                    ${chapterHeader}
                    ${contentBlock}
                </div>`;
            }
        });

        // Ìï¥ÏãúÌÉúÍ∑∏
        let tagsInCover = '';
        if (hashTags.trim()) {
            const tags = hashTags.split(',').map(tag => tag.trim().replace(/^#/, '')).filter(t => t);
            if (tags.length > 0) {
                const tagSpans = tags.map(tag => 
                    `<span style="display:inline-block; padding:4px 12px; margin:3px; border:1px solid rgba(255,255,255,0.25); border-radius:12px; font-size:10px; color:rgba(255,255,255,0.75); letter-spacing:0.03em;">${tag}</span>`
                ).join('');
                tagsInCover = `<div style="margin-top:24px;">${tagSpans}</div>`;
            }
        }

        // ÌëúÏßÄ
        const coverHTML = `
        <div style="width:100%; height:480px; display:table; background:url('${coverImg}') 50% 50% / cover no-repeat; box-sizing:border-box;">
            <div style="display:table-cell; vertical-align:bottom; text-align:center; padding:40px 28px 48px 28px; background:linear-gradient(to top, rgba(0,0,0,0.85), rgba(0,0,0,0.4), rgba(0,0,0,0.1), transparent);">
                <div style="color:#ffffff; text-shadow:0 1px 8px rgba(0,0,0,0.7);">
                    <div style="display:inline-block; font-size:10px; letter-spacing:0.4em; text-transform:uppercase; border:1px solid rgb(255,255,255); padding:4px 18px; margin-bottom:28px; color:rgb(255,255,255);">${tagText}</div>
                    <div style="font-size:40px; font-weight:300; letter-spacing:0.1em; line-height:1.3; margin-bottom:20px; text-shadow:0 2px 20px rgba(0,0,0,0.95), 0 0 60px rgba(0,0,0,0.7), 0 0 4px rgba(0,0,0,0.9);">${coverTitle}</div>
                    <div style="font-size:12px; letter-spacing:0.25em; color:rgba(255,255,255,0.5); margin-bottom:16px;">\u2727</div>
                    <div style="font-size:13px; letter-spacing:0.2em; opacity:0.85; margin-bottom:8px;">${coverSubtitle}</div>
                    <div style="font-size:10px; font-family:'Courier New',Courier,monospace; opacity:0.5;">${dateText}</div>
                    ${tagsInCover}
                </div>
            </div>
        </div>`;
         // Î≥ÄÍ≤Ω ÌõÑ
const showNote = document.getElementById('showNote').checked;
const commentHTML = showNote ? `
<div style="padding:32px 28px; background-color:${t.headerBg}; border-top:1px solid ${t.divider}; text-align:center;">
    <div style="margin-bottom:18px;">
        <span style="font-size:9px; font-weight:500; letter-spacing:0.3em; color:${t.textMuted}; text-transform:uppercase;">Note</span>
    </div>
    <div style="font-size:13px; line-height:2; color:${t.textSoft};">${commentText.replace(/\n/g, '<br>')}</div>
</div>` : '';

        // Ìë∏ÌÑ∞ (ÏûëÏÑ±Ïûê ÏûÖÎ†• Î∞òÏòÅ)
        const footerHTML = `
        <div style="padding:14px 24px; background-color:${t.contentBg}; border-top:1px solid ${t.divider}; text-align:center;">
            <span style="font-size:9px; color:${t.textMuted}; font-family:'Courier New',Courier,monospace; letter-spacing:0.1em;">CH.${document.querySelectorAll('.chapter-box').length}</span>
            <span style="font-size:9px; color:${t.textMuted}; margin:0 8px;">\u00B7</span>
            <span style="font-size:9px; color:${t.textMuted}; font-family:'Courier New',Courier,monospace;">by ${authorName}</span>
        </div>`;

        return `
<p><img style="width:0px;height:0px;" src="${coverImg}"></p>
<div style="max-width:680px; margin:0 auto; font-family:'Noto Serif KR','Nanum Myeongjo',Georgia,serif; background:${t.wrapBg}; overflow:hidden;">
    <div style="background:${t.cardBg}; border:1px solid ${t.border}; overflow:hidden;">
        ${coverHTML}
        ${charIntroHTML}
        ${chaptersHTML}   
        ${commentHTML}
        ${footerHTML}
    </div>
</div>`;
    }

    function renderPreview() {
        document.getElementById('preview-container').innerHTML = generateFullHTML();
    }

    function copyCode() {
        const code = generateFullHTML();
        navigator.clipboard.writeText(code).then(() => {
            alert("\u2705 HTML \ucf54\ub4dc\uac00 \ubcf5\uc0ac\ub418\uc5c8\uc2b5\ub2c8\ub2e4!");
        }).catch(() => {
            const ta = document.createElement("textarea");
            ta.value = code;
            ta.style.cssText = "position:fixed;left:-9999px;";
            document.body.appendChild(ta);
            ta.select();
            document.execCommand('copy');
            document.body.removeChild(ta);
            alert("\u2705 HTML \ucf54\ub4dc\uac00 \ubcf5\uc0ac\ub418\uc5c8\uc2b5\ub2c8\ub2e4!");
        });
    }

    window.onload = () => {
        loadSavedCustomTheme();
        addChapter();
        renderPreview();
    };

    let currentEditingTextarea = null;

    function openBigEditor(logId) {
        const textarea = document.getElementById(logId).querySelector('textarea');
        currentEditingTextarea = textarea;
        document.getElementById('bigEditorTextarea').value = textarea.value;
        document.getElementById('bigEditorModal').style.display = 'block';
        document.getElementById('bigEditorTextarea').focus();
    }

    function closeBigEditor() {
        document.getElementById('bigEditorModal').style.display = 'none';
        currentEditingTextarea = null;
    }
function insertTagBig(tag) {
    const el = document.getElementById('bigEditorTextarea');
    const start = el.selectionStart;
    const newLine = start > 0 && el.value[start-1] !== '\n' ? '\n' : '';
    el.value = el.value.substring(0, start) + newLine + tag + el.value.substring(el.selectionEnd);
    el.selectionStart = el.selectionEnd = start + newLine.length + tag.length;
    el.focus();
}

    function saveBigEditor() {
        if (currentEditingTextarea) {
            currentEditingTextarea.value = document.getElementById('bigEditorTextarea').value;
            renderPreview();
        }
        closeBigEditor();
    }
</script>
</body>
</html>
